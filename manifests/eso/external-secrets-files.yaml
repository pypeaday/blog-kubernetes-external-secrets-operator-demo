---
# File-based ExternalSecret for TLS certificates
# These will be mounted as files in /etc/secrets/
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: demo-app-tls-files
  namespace: default
spec:
  refreshInterval: "10s"
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault-backend
  target:
    name: demo-app-tls-files
    creationPolicy: Owner
    # Template to ensure proper file formatting
    template:
      type: Opaque
      data:
        tls.crt: "{{ .tls_crt }}"
        tls.key: "{{ .tls_key }}"
  data:
    - secretKey: tls_crt
      remoteRef:
        key: secret/data/demo-app/tls-files
        property: tls.crt
    - secretKey: tls_key
      remoteRef:
        key: secret/data/demo-app/tls-files
        property: tls.key
---
# File-based ExternalSecret for configuration files
# These will be mounted as files in /etc/config/
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: demo-app-config-files
  namespace: default
spec:
  refreshInterval: "10s"
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault-backend
  target:
    name: demo-app-config-files
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        database.conf: "{{ .database_conf }}"
  data:
    - secretKey: database_conf
      remoteRef:
        key: secret/data/demo-app/config-files
        property: database.conf
